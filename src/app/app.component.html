<div class="flex h-screen bg-gray-100 overflow-hidden">
  <!-- Sidebar -->
  <div
    [ngClass]="{
      'w-64': isSidebarVisible,
      'w-0 hidden md:block': !isSidebarVisible,
      'sidebar-transition': true
    }"
    class="bg-blue-900 text-white p-4 fixed h-full md:relative z-20 overflow-hidden"
  >
    <div class="flex justify-between mb-4 mr-10">
      <div class="flex items-center space-x-2">
        <!-- Toggle button (Hamburger for both mobile and desktop, like ChatGPT) -->
        <button (click)="toggleSidebar()" class="p-2 pt-0">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
      <h1 class="text-xl font-bold flex items-center text-white -translate-y-[10px]">
        FinAssistant
      </h1>
    </div>

    <!-- New Chat Button -->
    <button
      (click)="newChat()"
      class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded mb-4 flex items-center justify-center transition-colors duration-200"
    >
      <svg class="w-4 h-4 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
        <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
      </svg>
      New Chat
    </button>

    <!-- Search Input (Placeholder) -->
    <input
      type="text"
      placeholder="Search conversations..."
      class="w-full p-2 mb-4 rounded bg-blue-800 text-white placeholder-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200"
    />

    <!-- Conversations List -->
    <div class="overflow-y-auto max-h-[calc(100vh-200px)]">
      <div class="text-sm text-blue-200 mb-2">Recent Conversations</div>

      <!-- Loading Indicator -->
      @if (isLoading) {
        <div class="text-sm text-blue-300 text-center py-4">Loading...</div>
      }

      <!-- No Conversations Message -->
      @if (!isLoading && conversations.length === 0) {
        <div class="text-sm text-blue-300 text-center py-4">No recent conversations</div>
      }

      <!-- Conversations -->
      @for (conversation of conversations; track conversation.id) {
        <div
          (click)="selectConversation(conversation.id)"
          class="flex justify-between items-center rounded p-2 cursor-pointer mb-1 text-sm hover:bg-blue-800 transition-colors duration-200"
          [ngClass]="{'bg-blue-800': selectedConversationId === conversation.id}"
        >
          <div class="truncate flex-1">{{ conversation.title }}</div>
          <button
            (click)="deleteConversation(conversation.id, $event)"
            class="text-blue-300 hover:text-white p-1 rounded"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      }
    </div>
  </div>

  <!-- Main Content -->
  <div class="flex-1 flex flex-col overflow-hidden w-full">
    <!-- Top Bar -->
    <div class="bg-white border-b p-4 flex items-center justify-between">
      <div class="flex items-center pl-0">
        <!-- Menu button for mobile -->
        <button (click)="toggleSidebar()" class="mr-4 md:hidden">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
        <!-- Expand button for desktop when sidebar is collapsed -->
        <div class="flex space-x-2" *ngIf="!isSidebarVisible">
        <!-- Toggle button (Hamburger for both mobile and desktop, like ChatGPT) -->
        <button (click)="toggleSidebar()" class="p-2 pt-0">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
        <!-- Portfolio Button -->
        <button
          (click)="openPortfolio()"
          class="bg-[#4285F4] hover:bg-[#357ABD] text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-200"
        >
          Portfolio
        </button>
        <h1 class="text-xl font-bold md:hidden">FinAssistant</h1>
      </div>
      <div class="flex items-center space-x-4">
        <!-- Temporary Chat Mode Button -->
        <button
          class="bg-[#4285F4] hover:bg-[#357ABD] text-white px-3 py-1 rounded text-sm font-medium transition-colors duration-200"
        >
          Temporary Chat
        </button>
        <!-- Profile Icon -->
        <button
          class="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center hover:bg-gray-400 transition-colors duration-200"
        >
          <svg class="w-5 h-5 text-gray-600" fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
            />
          </svg>
        </button>
      </div>
    </div>

    <!-- Overlay for mobile when sidebar is open -->
    @if (isSidebarVisible) {
      <div (click)="toggleSidebar()" class="md:hidden fixed inset-0 bg-black bg-opacity-50 z-10"></div>
    }

    <!-- Chat Area -->
    <div class="flex-1 overflow-hidden relative">
      <app-chat [conversationId]="selectedConversationId"></app-chat>
    </div>
  </div>
</div>